<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>ESCANER EANs</title>
    <script src="https://unpkg.com/html5-qrcode@2.3.7/html5-qrcode.min.js"></script>
</head>
    <body>
        <h1>Escáner de Códigos EAN</h1>
        <div id="qr-reader" style="width: 300px"></div>
        <br>
        <button onclick="downloadExcel()">Descargar Excel</button>
        <br>
        <p id="contador">Escaneados: 0</p>
        <br>
        <a href="/EanScan/test.html">Pagina de pruebas</a>
                <a href="/EanScan/Code93.html">Code93</a>
        <script>
            const scannedCodes = [];
            var contador = 0
            function actualizarContador (){
                contador++;
                document.getElementById('contador').innerText = 'Escaneados: ' + contador;
            }

            function onScanSuccess(decodedText, decodedResult) {
                if (!scannedCodes.includes(decodedText)) {
                    scannedCodes.push(decodedText);
                    actualizarContador()
                    //alert(`Código EAN escaneado: ${decodedText}`);
                    
                }
            }
    
            function onScanFailure(error) {
                console.warn(`Error de escaneo: ${error}`);
            }
    
            const html5QrCode = new Html5Qrcode("qr-reader");
            html5QrCode.start(
                { facingMode: "environment" },
                {
                    fps: 10,
                    qrbox: 250
                },
                onScanSuccess,
                onScanFailure
            );
    
            function downloadExcel() {
                const csvContent = "data:text/csv;charset=utf-8," + scannedCodes.join("\n");
                const encodedUri = encodeURI(csvContent);
                const link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", "codigos_ean.csv");
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        </script>
</body>
</html>