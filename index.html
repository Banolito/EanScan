<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Escáner de Códigos EAN</title>
    <script src="https://unpkg.com/html5-qrcode@2.3.7/html5-qrcode.min.js"></script>
</head>
<body>
    <h1>Escáner de Códigos EAN</h1>
    <div id="qr-reader" style="width: 300px"></div>
    <button onclick="downloadExcel()">Descargar Excel</button>

    <script>
        const scannedCodes = [];

        function onScanSuccess(decodedText, decodedResult) {
            if (!scannedCodes.includes(decodedText)) {
                scannedCodes.push(decodedText);
                alert(`Código EAN escaneado: ${decodedText}`);
            }
        }

        function onScanFailure(error) {
            console.warn(`Error de escaneo: ${error}`);
        }

        const html5QrCode = new Html5Qrcode("qr-reader");
        html5QrCode.start(
            { facingMode: "environment" },
            {
                fps: 10,
                qrbox: 250
            },
            onScanSuccess,
            onScanFailure
        );

        function downloadExcel() {
            const csvContent = "data:text/csv;charset=utf-8," + scannedCodes.join("\n");
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "codigos_ean.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>